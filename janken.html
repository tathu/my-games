<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Åò„ÇÉ„Çì„Åë„Çì„Ç≤„Éº„É†</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
    }

    h1 {
      font-size: 2rem;
      color: #333;
      margin-bottom: 10px;
    }

    .score-board {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .score-item {
      text-align: center;
    }

    .score-label {
      font-size: 0.85rem;
      color: #888;
      font-weight: bold;
      text-transform: uppercase;
    }

    .score-value {
      font-size: 2rem;
      font-weight: bold;
    }

    .score-item.win .score-value  { color: #28a745; }
    .score-item.lose .score-value { color: #dc3545; }
    .score-item.draw .score-value { color: #ffc107; }

    .battle-area {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 25px 0;
      min-height: 140px;
    }

    .hand-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .hand-label {
      font-size: 0.85rem;
      color: #888;
      font-weight: bold;
    }

    .hand-emoji {
      font-size: 5rem;
      transition: transform 0.3s ease;
    }

    .hand-emoji.shake {
      animation: shake 0.5s ease infinite;
    }

    @keyframes shake {
      0%, 100% { transform: translateY(0); }
      50%       { transform: translateY(-10px); }
    }

    .vs-text {
      font-size: 1.5rem;
      font-weight: bold;
      color: #ccc;
    }

    .result-text {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 10px 0;
      min-height: 2.5rem;
      transition: all 0.3s ease;
    }

    .result-text.win  { color: #28a745; }
    .result-text.lose { color: #dc3545; }
    .result-text.draw { color: #ffc107; }

    .choices {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .choice-btn {
      background: none;
      border: 3px solid #e0e0e0;
      border-radius: 16px;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .choice-btn:hover {
      border-color: #667eea;
      background: #f0f0ff;
      transform: translateY(-3px);
    }

    .choice-btn:active {
      transform: translateY(0);
    }

    .choice-btn .emoji {
      font-size: 2.5rem;
    }

    .choice-btn .name {
      font-size: 0.85rem;
      font-weight: bold;
      color: #555;
    }

    .janken-call {
      font-size: 1.6rem;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }

    .countdown-area {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }

    .countdown-ring {
      position: relative;
      width: 64px;
      height: 64px;
    }

    .countdown-ring svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .ring-bg {
      fill: none;
      stroke: #e9ecef;
      stroke-width: 5;
    }

    .ring-fill {
      fill: none;
      stroke: #667eea;
      stroke-width: 5;
      stroke-linecap: round;
      stroke-dasharray: 163.4;
      stroke-dashoffset: 0;
      transition: stroke-dashoffset 1s linear, stroke 0.3s;
    }

    .countdown-num {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: #667eea;
      transition: color 0.3s;
    }

    .countdown-num.danger {
      color: #dc3545;
      animation: pulse 0.5s ease infinite alternate;
    }

    .ring-fill.danger {
      stroke: #dc3545;
    }

    @keyframes pulse {
      from { transform: scale(1); }
      to   { transform: scale(1.2); }
    }

    .reset-btn {
      margin-top: 15px;
      padding: 10px 30px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .reset-btn:hover {
      background: #5a6fd6;
    }

    .back-btn {
      display: inline-block;
      margin-top: 12px;
      padding: 8px 24px;
      background: none;
      color: #aaa;
      border: 2px solid #e0e0e0;
      border-radius: 30px;
      font-size: 0.9rem;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚úä „Åò„ÇÉ„Çì„Åë„Çì„Ç≤„Éº„É†</h1>

    <div class="score-board">
      <div class="score-item win">
        <div class="score-label">Âãù„Å°</div>
        <div class="score-value" id="win-count">0</div>
      </div>
      <div class="score-item draw">
        <div class="score-label">„ÅÇ„ÅÑ„Åì</div>
        <div class="score-value" id="draw-count">0</div>
      </div>
      <div class="score-item lose">
        <div class="score-label">Ë≤†„Åë</div>
        <div class="score-value" id="lose-count">0</div>
      </div>
    </div>

    <div class="battle-area">
      <div class="hand-display">
        <div class="hand-label">„ÅÇ„Å™„Åü</div>
        <div class="hand-emoji" id="player-hand">ü§ú</div>
      </div>
      <div class="vs-text">VS</div>
      <div class="hand-display">
        <div class="hand-label">„Ç≥„É≥„Éî„É•„Éº„Çø</div>
        <div class="hand-emoji" id="cpu-hand">ü§ú</div>
      </div>
    </div>

    <div class="result-text" id="result-text">Êâã„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</div>

    <div class="janken-call" id="janken-call">„Åò„ÇÉ„Çì„Åë„ÇìÔºÅ</div>

    <div class="countdown-area">
      <div class="countdown-ring">
        <svg viewBox="0 0 60 60">
          <circle cx="30" cy="30" r="26" class="ring-bg" />
          <circle cx="30" cy="30" r="26" class="ring-fill" id="ring-fill" />
        </svg>
        <div class="countdown-num" id="countdown-num">5</div>
      </div>
    </div>

    <div class="choices">
      <button class="choice-btn" onclick="play('rock')">
        <span class="emoji">‚úä</span>
        <span class="name">„Ç∞„Éº</span>
      </button>
      <button class="choice-btn" onclick="play('scissors')">
        <span class="emoji">‚úåÔ∏è</span>
        <span class="name">„ÉÅ„Éß„Ç≠</span>
      </button>
      <button class="choice-btn" onclick="play('paper')">
        <span class="emoji">üñêÔ∏è</span>
        <span class="name">„Éë„Éº</span>
      </button>
    </div>

    <button class="reset-btn" onclick="resetScore()">„Çπ„Ç≥„Ç¢„É™„Çª„ÉÉ„Éà</button>
    <br>
    <a class="back-btn" href="index.html">‚Üê „Éà„ÉÉ„Éó„Å∏Êàª„Çã</a>
  </div>

  <script>
    const HANDS = {
      rock:    { emoji: '‚úä', name: '„Ç∞„Éº' },
      scissors:{ emoji: '‚úåÔ∏è', name: '„ÉÅ„Éß„Ç≠' },
      paper:   { emoji: 'üñêÔ∏è', name: '„Éë„Éº' },
    };

    // rock „Åå scissors „Å´Âãù„Å§„ÄÅscissors „Åå paper „Å´Âãù„Å§„ÄÅpaper „Åå rock „Å´Âãù„Å§
    const WINS_AGAINST = {
      rock: 'scissors',
      scissors: 'paper',
      paper: 'rock',
    };

    const score = { win: 0, draw: 0, lose: 0 };

    const TOTAL_TIME    = 5;
    const CIRCUMFERENCE = 2 * Math.PI * 26; // ‚âà 163.4

    let resetTimer    = null;
    let countdownVal  = TOTAL_TIME;
    let countdownTimer = null;

    function startCountdown() {
      if (countdownTimer) clearInterval(countdownTimer);
      countdownVal = TOTAL_TIME;
      updateCountdownUI();
      countdownTimer = setInterval(() => {
        countdownVal--;
        updateCountdownUI();
        if (countdownVal <= 0) {
          clearInterval(countdownTimer);
          timeUp();
        }
      }, 1000);
    }

    function stopCountdown() {
      if (countdownTimer) { clearInterval(countdownTimer); countdownTimer = null; }
    }

    function updateCountdownUI() {
      const numEl  = document.getElementById('countdown-num');
      const ringEl = document.getElementById('ring-fill');
      const offset = CIRCUMFERENCE * (1 - countdownVal / TOTAL_TIME);
      ringEl.style.strokeDashoffset = offset;
      numEl.textContent = countdownVal;
      if (countdownVal <= 2) {
        numEl.classList.add('danger');
        ringEl.classList.add('danger');
      } else {
        numEl.classList.remove('danger');
        ringEl.classList.remove('danger');
      }
    }

    function timeUp() {
      setChoiceBtnsDisabled(true);
      const resultEl = document.getElementById('result-text');
      resultEl.className = 'result-text lose';
      resultEl.textContent = '‚è∞ ÊôÇÈñìÂàá„ÇåÔºÅ„Çπ„Ç≥„Ç¢„É™„Çª„ÉÉ„Éà„ÅßÂÜçÊåëÊà¶';
      document.getElementById('janken-call').style.visibility = 'hidden';
    }

    function setChoiceBtnsDisabled(disabled) {
      document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = disabled);
    }

    function getRandomHand() {
      const keys = Object.keys(HANDS);
      return keys[Math.floor(Math.random() * keys.length)];
    }

    function judge(player, cpu) {
      if (player === cpu) return 'draw';
      if (WINS_AGAINST[player] === cpu) return 'win';
      return 'lose';
    }

    function play(playerChoice) {
      stopCountdown();
      if (resetTimer) clearTimeout(resetTimer);

      const cpuChoice = getRandomHand();
      const result = judge(playerChoice, cpuChoice);

      document.getElementById('player-hand').textContent = HANDS[playerChoice].emoji;
      document.getElementById('cpu-hand').textContent    = HANDS[cpuChoice].emoji;
      document.getElementById('janken-call').style.visibility = 'hidden';

      const resultEl = document.getElementById('result-text');
      resultEl.className = 'result-text';

      if (result === 'win') {
        resultEl.textContent = 'üéâ „ÅÇ„Å™„Åü„ÅÆÂãù„Å°ÔºÅ';
        resultEl.classList.add('win');
        score.win++;
      } else if (result === 'lose') {
        resultEl.textContent = 'üò¢ „ÅÇ„Å™„Åü„ÅÆË≤†„Åë‚Ä¶';
        resultEl.classList.add('lose');
        score.lose++;
      } else {
        resultEl.textContent = 'ü§ù „ÅÇ„ÅÑ„ÅìÔºÅ';
        resultEl.classList.add('draw');
        score.draw++;
      }

      document.getElementById('win-count').textContent  = score.win;
      document.getElementById('draw-count').textContent = score.draw;
      document.getElementById('lose-count').textContent = score.lose;

      // 1ÁßíÂæå„Å´„Åò„ÇÉ„Çì„Åë„ÇìÔºÅ„ÇíÂÜçË°®Á§∫„Åó„Å¶„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÂÜçÈñã
      resetTimer = setTimeout(() => {
        resultEl.className = 'result-text';
        resultEl.textContent = 'Êâã„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ';
        document.getElementById('player-hand').textContent = 'ü§ú';
        document.getElementById('cpu-hand').textContent    = 'ü§ú';
        document.getElementById('janken-call').style.visibility = 'visible';
        resetTimer = null;
        startCountdown();
      }, 1000);
    }

    function resetScore() {
      stopCountdown();
      if (resetTimer) { clearTimeout(resetTimer); resetTimer = null; }
      score.win = score.draw = score.lose = 0;
      document.getElementById('win-count').textContent  = 0;
      document.getElementById('draw-count').textContent = 0;
      document.getElementById('lose-count').textContent = 0;
      document.getElementById('player-hand').textContent = 'ü§ú';
      document.getElementById('cpu-hand').textContent    = 'ü§ú';
      const resultEl = document.getElementById('result-text');
      resultEl.className = 'result-text';
      resultEl.textContent = 'Êâã„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ';
      document.getElementById('janken-call').style.visibility = 'visible';
      setChoiceBtnsDisabled(false);
      startCountdown();
    }

    startCountdown();
  </script>
</body>
</html>
